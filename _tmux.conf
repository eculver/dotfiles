## command prefix CTRL+a (like screen)
set -g prefix C-a
bind C-a send-prefix

# config reloading CTRL+r
bind C-r source-file ~/.tmux.conf \; display "Reloaded .tmux.conf"

# enable switching panes, scrolling, and copy-mode by using mouse
set -g mouse on

# lots of scrollback
set -g history-limit 10000

## basic settings
set-window-option -g mode-keys vi
set-option -g status-keys vi
set -g default-terminal "xterm-256color"

## window title
set-option -g set-titles on
set-option -g set-titles-string '#S:#I.#P #W' # window number,program name,active (or not)
set-window-option -g automatic-rename on # auto name

# no delay for escape key press
set -sg escape-time 0

# extend repeat last command timer; makes resizing windows easier.
set -g repeat-time 1000

## no visual activity
set -g visual-activity off
set -g visual-bell off

## status bar generated by Tmuxline
set -g status 'on'
set -g status-style 'bg=colour236,none'
set -g status-justify 'left'
set -g status-left-length '100'
set -g status-left-style 'none'
set -g status-right-length '100'
set -g status-right-style 'none'
set -g status-left '#[fg=colour231,bg=colour236,bold] #S '
set -g status-right '#[fg=colour231,bg=colour236] %Y-%m-%d  %l:%M %p  #{date_utc} #(uptime | cut -d "," -f3- | cut -d ":" -f2)  #{battery_percentage} #[fg=colour231,bg=colour236,nobold,nounderscore,noitalics]#[fg=colour236,bg=colour231,bold] #h '

set -g message-command-style 'bg=colour231,fg=colour236,none'
set -g message-style 'bg=colour236,fg=colour231'
set -g pane-active-border-style 'fg=colour254'
set -g pane-border-style 'fg=colour240'
setw -g window-status-style 'bg=colour236,fg=colour231,none'
setw -g window-status-activity-style 'bg=colour236,fg=colour231,none'
setw -g window-status-separator ''
setw -g window-status-format '#[fg=color231,bg=colour236] #I: #W '
setw -g window-status-current-format '#[fg=colour236,bg=colour231,nobold,nounderscore,noitalics]#[fg=colour236,bg=colour231] #I: #[fg=colour236,bg=colour231,bold]#W #[fg=colour231,bg=colour236,nobold,nounderscore,noitalics]'

# Keybinds {{{

# screen-like last-window binding
bind C-b last-window

# screen-like last-pane binding
bind Tab last-pane

## copy mode to escape key
unbind [
bind Escape copy-mode

## bind paste to P
unbind P
bind P paste-buffer

## splitting and cycling
unbind %
unbind '"'
bind + split-window -h # horizontal split
bind _ split-window -v # vertical split
bind | command-prompt -p command: "split-window -h %%"
bind - command-prompt -p command: "split-window -v %%"

# moving panes around
#unbind !
#bind < break-pane
#bind > choose-tree -b 'join-pane -s %%' -c 'join-pane -s %%'

# vim-style keybinds {{{

## select pane
unbind Up
unbind Down
unbind Left
unbind Right
bind j select-pane -D
bind k select-pane -U
bind h select-pane -L
bind l select-pane -R

# resizing
unbind C-Up
unbind C-Down
unbind C-Left
unbind C-Right
bind -r J resize-pane -D
bind -r K resize-pane -U
bind -r H resize-pane -L
bind -r L resize-pane -R

# fast resizing w/ Mod
unbind M-Up
unbind M-Down
unbind M-Left
unbind M-Right
bind -r C-J resize-pane -D 5
bind -r C-K resize-pane -U 5
bind -r C-H resize-pane -L 5
bind -r C-L resize-pane -R 5

# window cycling
bind -n M-Left  previous-window
bind -n M-Right next-window

# session cycling
bind -n M-Up switch-client -p
bind -n M-Down switch-client -n

# }}}

## alias for running a command across all sessions, windows and panes
bind P command-prompt -p "Command:" \
  "run \"tmux list-sessions -F '##{session_name}' | xargs -I SESS \
  tmux list-windows -t SESS -F 'SESS:##{window_index}' | xargs -I SESS_WIN \
  tmux list-panes -t SESS_WIN -F 'SESS_WIN.##{pane_index}' | xargs -I SESS_WIN_PANE \
  tmux send-keys -t SESS_WIN_PANE '%1' Enter\""

## TODO: alias for running a command across all windows and panes within the current session
## TODO: alias for running a command across all panes within the current window

# }}}

# Plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'eculver/tmux-date'

# Initialize TMUX plugin manager
run '~/.tmux/plugins/tpm/tpm'
